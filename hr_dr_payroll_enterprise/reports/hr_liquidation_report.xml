<?xml version="1.0" encoding="utf-8" ?>
<odoo>
  <data>
    <template id="assets_liquidation_template">
      <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
          <t t-call="web.external_layout">
            <div class="page">
              <div class="oe_structure"/>

              <div class="row">
                <div class="col text-center">
                  <h2>LIQUIDACIÓN DE HABERES</h2>
                </div>
              </div>

              <div class="row">
                <div class="col-4">
                  <span><strong>Nombres del colaborador</strong></span>
                </div>
                <div>
                  <span t-esc="o.employee_id.name"/>
                </div>
              </div>
              <div class="row">
                <div class="col-4">
                  <span><strong>Fecha de ingreso</strong></span>
                </div>
                <div class="col-2">
                  <span t-esc="o.date_from"/>
                </div>
                <div class="col-4">
                  <span><strong>Fecha de salida</strong></span>
                </div>
                <div class="col-2">
                  <span t-esc="o.date_to"/>
                </div>
              </div>
              <div class="row">
                <div class="col-4">
                  <span><strong>Cédula</strong></span>
                </div>
                <div class="col-2">
                  <span t-esc="o.employee_id.identification_id"/>
                </div>
                <div class="col-4">
                  <span><strong>Localidad/Área</strong></span>
                </div>
                <div class="col-2">
                  <span t-esc="o.employee_id.address_id.street or 'No Registrado'"/>
                </div>
              </div>
              <div class="row">
                  <div class="col-4">
                      <span><strong>Motivo</strong></span>
                  </div>
                  <div>
                      <span t-esc="o.cause_id.name"/>
                  </div>
              </div>

              <div class="row">
                <div class="col-4">
                  <span><strong>Sueldo</strong></span>
                </div>
                <div>
                  <span t-field="o.contract_id.wage"/>
                </div>
              </div>
              <div class="row">
                <div class="col-4">
                  <span><strong>Tipo de Contrato</strong></span>
                </div>
                <div>
                  <span t-esc="o.contract_id.struct_id.name" />
                </div>
              </div>
              <div class="row">
                <div class="col-4">
                  <span><strong>Cargo</strong></span>
                </div>
                <div>
                  <span t-esc="o.contract_id.job_id.name or o.contract_id.IESS_sector_code.position_id"/>
                </div>
              </div>

              <div class="row" style="background-color: silver; margin-top: 16px; border: 1px solid black;">
                <div class="col-7" style="border: 1px solid black;">
                  <span><strong>CONCEPTO</strong></span>
                </div>
                <div class="col-2" style="border: 1px solid black;">
                  <span><strong>DIAS</strong></span>
                </div>
                <div class="col-3" style="border: 1px solid black;">
                  <span><strong>VALORES</strong></span>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <center><span>Sueldo (Proporcional)</span></center>
                  <div class="row">
                    <div class="col text-center">
                      Del <span t-esc="o.date_to.replace(day=1)"/> al <span t-esc="o.date_to"/>
                    </div>
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="o.date_to.replace(day=1)"/>-->
<!--                    </div>-->
<!--                    <div class="col-2 text-center" style="border: 1px solid black;">-->
<!--                      <span>al</span>-->
<!--                    </div>-->
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="o.date_to"/>-->
<!--                    </div>-->
                  </div>
                </div>
                <div class="col-2 text-center" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.worked_days_line_ids" t-as="days">
                    <t t-if="days.code == 'WORK100'">
                      <span t-esc="days.number_of_days" />
                    </t>
                  </t>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.line_ids" t-as="salary">
                    <t t-if="salary.code == 'SALARIO_NOMINAL'">
                      <span>$</span><span t-esc="'%.2f' % salary.total" />
                    </t>
                  </t>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <center><span>Décimo XIII Sueldo (Proporcional)</span></center>
                  <t t-set="xiii_period" t-value="o.get_xiii_period()"/>
                  <div class="row">
                    <div class="col text-center">
                      Del <span t-esc="xiii_period[0]"/> al <span t-esc="xiii_period[1]"/>

                    </div>
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="xiii_period[0]"/>-->
<!--                    </div>-->
<!--                    <div class="col-2 text-center" style="border: 1px solid black;">-->
<!--                      <span>al</span>-->
<!--                    </div>-->
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="xiii_period[1]"/>-->
<!--                    </div>-->
                  </div>
                </div>
                <div class="col-2 text-center" style="border: 1px solid black;">
                  <span> </span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % abs(o.get_xiii_amount())"/>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <center><span>Decimo XIV Sueldo (Proporcional)</span></center>
                  <t t-set="xiv_period" t-value="o.get_xiv_period()"/>
                  <div class="row">
                    <div class="col text-center">
                      Del <span t-esc="xiv_period[0]"/> al <span t-esc="xiv_period[1]"/>
                    </div>
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="xiv_period[0]"/>-->
<!--                    </div>-->
<!--                    <div class="col-2 text-center" style="border: 1px solid black;">-->
<!--                      <span>al</span>-->
<!--                    </div>-->
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="xiv_period[1]"/>-->
<!--                    </div>-->
                  </div>
                </div>
                <div class="col-2" style="border: 1px solid black;">
                  <span> </span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % abs(o.get_xiv_amount())"/>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <center><span>Vacaciones (Proporcional)</span></center>
                  <div class="row">
                    <div class="col text-center">
                      Del <span t-esc="o.date_from.year"/> al <span t-esc="o.date_to.year"/> (<span t-esc="o.date_to.strftime('%d de %B del %Y')"/>)
                    </div>
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="o.date_from.strftime('%Y')"/>-->
<!--                      <span t-esc="o.date_to.strftime('%Y')"/>-->
<!--                    </div>-->
<!--                    <div class="col-2 text-center" style="border: 1px solid black;">-->
<!--                      <span>al</span>-->
<!--                    </div>-->
<!--                    <div class="col-5 text-center" style="border: 1px solid black;">-->
<!--                      <span t-esc="o.date_to.strftime('%d de %B del %Y')"/>-->
<!--                    </div>-->
                  </div>
                </div>
                <div class="col-2" style="border: 1px solid black;">
                  <span> </span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.line_ids" t-as="payslip">
                    <t t-if="payslip.code == 'PAY_VACATIONS'">
                      <span>$</span><span t-esc="'%.2f' % abs(o.get_vacations_amount())"/>
                    </t>
                  </t>
                </div>
              </div>

              <div class="row" style="background-color: silver; margin-top: 10px; border: 1px solid black;">
                <div class="col-7" style="border: 1px solid black;">
                  <span><strong>CONCEPTO</strong></span>
                </div>
                <div class="col-2" style="border: 1px solid black;">
                  <span><strong>HORAS</strong></span>
                </div>
                <div class="col-3" style="border: 1px solid black;">
                  <span><strong>VALORES</strong></span>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <span>Horas Extras 25% Jornada Nocturna</span>
                </div>
                <div class="col-2 text-center" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.input_line_ids" t-as="input">
                    <t t-if="input.input_type_id.code in ['HORA_NOCTURNA', 'HORA_NOCTURNA_PREVIOUS_YEAR']">
                      <span t-esc="'%.2f' % (input.amount)"/>
                    </t>
                  </t>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.line_ids" t-as="line">
                    <t t-if="line.code == 'HORA_NOCTURNA'">
                      <span>$</span><span t-esc="'%.2f' % line.total"/>
                    </t>
                  </t>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <span>Horas Extras 50%</span>
                </div>
                <div class="col-2 text-center" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.input_line_ids" t-as="input">
                    <t t-if="input.input_type_id.code in ['HORA_EXTRA_SUPLEMENTARIA', 'HORA_EXTRA_SUPLEMENTARIA_PREVIOUS_YEAR']">
                      <span t-esc="'%.2f' % (input.amount)"/>
                    </t>
                  </t>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.line_ids" t-as="line">
                    <t t-if="line.code == 'HORA_EXTRA_SUPLEMENTARIA'">
                      <span>$</span><span t-esc="'%.2f' % line.total"/>
                    </t>
                  </t>
                </div>
              </div>

              <div class="row">
                <div class="col-7" style="border: 1px solid black;">
                  <span>Horas Extras 100%</span>
                </div>
                <div class="col-2 text-center" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.input_line_ids" t-as="input">
                    <t t-if="input.input_type_id.code in ['HORA_EXTRA_EXTRAORDINARIA', 'HORA_EXTRA_EXTRAORDINARIA_PREVIOUS_YEAR']">
                      <span t-esc="'%.2f' % (input.amount)"/>
                    </t>
                  </t>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <t t-foreach="o.payslip_id.line_ids" t-as="line">
                    <t t-if="line.code == 'HORA_EXTRA_EXTRAORDINARIA'">
                      <span>$</span><span t-esc="'%.2f' % line.total"/>
                    </t>
                  </t>
                </div>
              </div>

<!--              <div class="row">-->
<!--                <div class="col-7" style="border: 1px solid black;">-->
<!--                  <span>Feriados</span>-->
<!--                </div>-->
<!--                <div class="col-2" style="border: 1px solid black;">-->
<!--                  <span>   </span>-->
<!--                </div>-->
<!--                <div class="col-3 text-end" style="border: 1px solid black;">-->
<!--                  <span>$0</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              <p style="page-break-before:always;"/>-->

              <t t-set="total_compensation" t-value="0.00"/>
              <div class="row" style="background-color: silver; margin-top: 10px;">
                <div class="col-12" style="border: 1px solid black;">
                  <span><strong>Indemnizaciones</strong></span>
                </div>
              </div>

              <t t-foreach="o.payslip_id.input_line_ids" t-as="input">
                <div class="row" t-if="input.input_type_id.code in ('INDE', 'INDE_EVICTION', 'INDE_LEADER', 'INDE_TERMINATION', 'INDE_PREGNANCY', 'INDE_DISABILITY')">
                  <div class="col-7" style="border: 1px solid black;">
                    <span t-if="input.input_type_id.code == 'INDE_EVICTION'">Art.185</span>
                    <span t-elif="input.input_type_id.code == 'INDE_LEADER'">Art.187</span>
                    <span t-elif="input.input_type_id.code == 'INDE_TERMINATION'">Art.189</span>
                    <span t-elif="input.input_type_id.code == 'INDE_PREGNANCY'">Art.154</span>
                    <span t-elif="input.input_type_id.code == 'INDE_DISABILITY'">Discapacidad</span>
                    <span t-if="input.input_type_id.code == 'INDE'">Mutuo acuerdo</span>
                  </div>
                  <div class="col-2 text-center" style="border: 1px solid black;">
                    <span t-if="input.input_type_id.code == 'INDE_EVICTION'"> * 25% * </span>
                    <span t-elif="input.input_type_id.code == 'INDE_LEADER'"> * 100% * </span>
                    <span t-elif="input.input_type_id.code == 'INDE_TERMINATION'"> * 100% * </span>
                    <span t-elif="input.input_type_id.code == 'INDE_PREGNANCY'"> * 100% * </span>
                    <span t-elif="input.input_type_id.code == 'INDE_DISABILITY'"> * 100% * </span>
                    <span t-if="input.input_type_id.code == 'INDE'"> * 100% * </span>
                  </div>
                  <div class="col-3 text-end" style="border: 1px solid black;">
                    <span>$</span><span t-esc="'%.2f' % (input.amount)"/>
                    <t t-set="total_compensation" t-value="total_compensation + input.amount"/>
                  </div>
                </div>
              </t>

              <div class="row" style="margin-bottom: 10px;">
                <div class="col-9" style="background-color: silver; border: 1px solid black;">
                  <span>Total indemnizaciones</span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % total_compensation"/>
                </div>
              </div>

              <t t-foreach="o.payslip_id.line_ids" t-as="line">
                <t t-if="line.category_id.code in ('INGRESOS','INGRESOS_NGBS')">
                  <t t-if="line.code not in ('HORA_NOCTURNA','HORA_EXTRA_SUPLEMENTARIA', 'HORA_EXTRA_EXTRAORDINARIA', 'SALARIO_NOMINAL', 'PAY_VACATIONS', 'TAKEN_VACATIONS', 'DECIMO_TERCERO_MENSUAL', 'DECIMO_CUARTO_MENSUAL', 'INDEMNIZACION', 'INDEMNIZACION_DESAHUCIO', 'INDEMNIZACION_DESPIDO', 'INDEMNIZACION_LIDER', 'INDEMNIZACION_EMBARAZO', 'INDEMNIZACION_DISCAPACIDAD')">
                    <t t-if="line.total > 0">
                    <div class="row">
                      <div class="col-7" style="border: 1px solid black;">
                        <span t-esc="line.name"/>
                      </div>
                      <div class="col-2 text-center" style="border: 1px solid black;">
                        <span> </span>
                      </div>
                      <div class="col-3 text-end" style="border: 1px solid black;">
                        <span>$</span><span t-esc="'%.2f' % line.total"/>
                      </div>
                    </div>
                    </t>
                  </t>
                </t>
              </t>

              <t t-set="total_incomes" t-value="o.get_total_incomes()"/>
              <div class="row" style="background-color: silver; margin-top: 10px;">
                <div class="col-9" style="border: 1px solid black;">
                  <span><strong>TOTAL INGRESOS</strong></span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % total_incomes"/>
                </div>
              </div>

              <div class="row" style="background-color: silver; margin-top: 10px; border: 1px solid black;">
                <div class="col-12">
                  <span><strong>DESCUENTOS</strong></span>
                </div>
              </div>
              <t t-foreach="o.payslip_id.line_ids" t-as="line">
                <t t-if="(line.category_id.code in ['EGRESOS', 'EGRESOS_PASIVOS']) and line.total != 0">
                  <div class="row">
                    <div class="col-9" style="border: 1px solid black;">
                      <span t-esc="line.name"/>
                    </div>
                    <div class="col-3 text-end" style="border: 1px solid black;">
                      <span>$</span><span t-esc="'%.2f' % abs(line.total)"/>
                    </div>
                  </div>
                </t>
              </t>

              <t t-set="total_expenses" t-value="o.get_total_expenses()"/>
              <div class="row" style="background-color: silver; margin-top: 10px;">
                <div class="col-9" style="border: 1px solid black;">
                  <span><strong>TOTAL DESCUENTOS</strong></span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % total_expenses"/>
                </div>
              </div>

              <div class="row" style="background-color: silver; margin-top: 10px;">
                <div class="col-9" style="border: 1px solid black;">
                  <span><strong>NETO A RECIBIR</strong></span>
                </div>
                <div class="col-3 text-end" style="border: 1px solid black;">
                  <span>$</span><span t-esc="'%.2f' % (total_incomes - total_expenses)"/>
                </div>
              </div>

              <br/><br/><br/><br/><br/><br/>
              <div class="row mt32">
                <div class="col-3" style="border-top: 1px solid black;">
                  <center><span><strong>Liquidador</strong></span></center>
                </div>
                <div class="col-1"/>
                <div class="col-4" style="border-top: 1px solid black;">
                  <center><span><strong>Aprobado</strong></span></center>
                </div>
                <div class="col-1"/>
                <div class="col-3" style="border-top: 1px solid black;">
                  <center><span><strong>Ex-Empleado</strong></span></center>
                </div>
              </div>
            </div>
          </t>
        </t>
      </t>
    </template>

    <record id="assets_liquidation_report" model="ir.actions.report">
      <field name="name">Assets liquidation</field>
      <field name="model">hr.assets.liquidation</field>
      <field name="report_type">qweb-pdf</field>
      <field name="report_name">hr_dr_payroll_enterprise.assets_liquidation_template</field>
      <field name="report_file">hr_dr_payroll_enterprise.assets_liquidation_template</field>
      <field name="print_report_name">'Assets liquidation - %s' % (object.employee_id.name).replace('/', '')</field>
<!--      <field name="binding_model_id" ref="model_hr_payslip"/>-->
<!--      <field name="binding_type">report</field>-->
    </record>
<!--        <report-->
<!--        string="LIQUIDACION DE HABERES"-->
<!--        attachment_use="True"-->
<!--        attachment="('Liquidacion de Finiquito '+(object.name.name or '').replace('/','')+'.pdf')"-->
<!--        />-->
  </data>
</odoo>